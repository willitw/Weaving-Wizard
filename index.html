<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Weaving Wizard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #1a1a1a;
      color: #f0f0f0;
      margin: 0;
      padding: 30px;
    }
    #container {
      background-color: #2a2a2a;
      padding: 30px;
      border-radius: 8px;
      max-width: 900px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.4);
    }
    h1 {
      margin-top: 0;
    }
    #numberBoxes {
      display: flex;
      justify-content: space-between;
      margin: 20px auto;
      width: 100%;
      cursor: pointer;
    }
    .numberBox {
      flex: 1;
      margin: 0 5px;
      font-size: 100px;
      padding: 50px 0;
      text-align: center;
      background-color: #444;
      border-radius: 4px;
      transition: background-color 0.4s ease, color 0.4s ease;
    }
    .highlight {
      color: black;
    }
    #pickInfo {
      margin-top: 10px;
      font-size: 18px;
    }
    .main-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }
    .main-buttons button {
      font-size: 22px;
      padding: 15px 30px;
      border-radius: 4px;
      border: none;
      background-color: #5a5a5a;
      color: white;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .main-buttons button:hover {
      background-color: #777;
    }
    #progressContainer {
      width: 100%;
      background: #333;
      height: 10px;
      margin-top: 20px;
      border-radius: 4px;
    }
    #progress {
      height: 10px;
      background: limegreen;
      width: 0%;
      border-radius: 4px;
    }
    #rulesContainer {
      margin-top: 30px;
      background-color: #3a3a3a;
      padding: 20px;
      border-radius: 4px;
    }
    #colorRulesList {
      margin-top: 10px;
    }
    .ruleItem {
      margin: 5px 0;
      padding: 6px;
      background-color: #444;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .colorBox {
      width: 20px;
      height: 20px;
      display: inline-block;
      margin-right: 10px;
      border-radius: 2px;
    }
    .ruleText {
      display: flex;
      align-items: center;
    }
    .ruleItem button {
      padding: 4px 10px;
      font-size: 12px;
      border: none;
      border-radius: 4px;
      background-color: #aa3333;
      color: white;
      cursor: pointer;
    }
    input[type="text"], input[type="number"], input[type="color"], input[type="file"] {
      padding: 6px;
      font-size: 16px;
      border-radius: 4px;
      border: none;
      margin: 5px;
    }
    label {
      font-size: 16px;
    }
    .card {
      background-color: #3a3a3a;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div id="container">
    <h1>Weaving Wizard</h1>

    <div id="numberBoxes" onclick="nextNumber()">
      <div class="numberBox" id="box1"></div>
      <div class="numberBox" id="box2"></div>
      <div class="numberBox" id="box3"></div>
      <div class="numberBox" id="box4"></div>
      <div class="numberBox" id="box5"></div>
      <div class="numberBox" id="box6"></div>
    </div>

    <div id="pickInfo">Pick: 0 of 0</div>

    <div id="progressContainer">
      <div id="progress"></div>
    </div>

    <div class="main-buttons">
      <button onclick="nextNumber()">Next</button>
      <button onclick="prevNumber()">Previous</button>
    </div>

    <div class="card">
      <div>
        <label for="patternInput">Enter Pattern (comma-separated):</label><br>
        <input type="text" id="patternInput" placeholder="e.g. 1,2,3,4">
        <button onclick="loadPattern()">Load Pattern</button>
      </div>
      <div style="margin-top: 20px;">
        <label for="jumpInput">Jump to Pick:</label><br>
        <input type="number" id="jumpInput" style="width: 80px;" min="1">
        <button onclick="jumpToPick()">Go</button>
        <button onclick="reset()">Reset</button>
      </div>
    </div>

    <div class="card">
      <div style="margin-bottom: 10px;">
        <label><input type="checkbox" id="loopToggle" checked> Loop Pattern</label>
      </div>
      <div>
        <label><input type="checkbox" id="speakToggle" checked> Read Number Aloud</label>
      </div>
    </div>

    <div class="card">
      <label for="customSound">Upload Custom Sound:</label><br>
      <input type="file" id="customSound" accept="audio/*" onchange="loadCustomSound(event)">
    </div>

    <div id="rulesContainer">
      <h3>Color Rules</h3>
      <input type="text" id="ruleInput" placeholder="e.g. 1,2,4">
      <input type="color" id="ruleColor" value="#00ff00">
      <button onclick="addColorRule()">Add Rule</button>
      <div id="colorRulesList"></div>
    </div>
  </div>

  <script>
    let pattern = [];
    let currentIndex = 0;
    let customAudio = null;
    let colorRules = [];

    function isColorLight(hex) {
      const c = hex.substring(1);
      const rgb = parseInt(c, 16);
      const r = (rgb >> 16) & 0xff;
      const g = (rgb >> 8) & 0xff;
      const b = (rgb >> 0) & 0xff;
      const luma = 0.2126 * r + 0.7152 * g + 0.0722 * b;
      return luma > 150;
    }

    function loadPattern() {
      const input = document.getElementById("patternInput").value.replace(/\s/g, '');
      const rawItems = input.split(',');
      pattern = [];
      rawItems.forEach(item => {
        if (item.length === 0) return;
        if (item.length === 1) {
          const num = parseInt(item);
          if (num >= 1 && num <= 6) pattern.push([num]);
        } else {
          const nums = item.split('').map(d => parseInt(d)).filter(n => n >= 1 && n <= 6);
          if (nums.length) pattern.push(nums);
        }
      });
      currentIndex = 0;
      updateDisplay();
    }

    function updateDisplay() {
      const pickInfo = document.getElementById("pickInfo");
      for (let i = 1; i <= 6; i++) {
        const box = document.getElementById("box" + i);
        box.textContent = "";
        box.classList.remove("highlight");
        box.style.backgroundColor = "#444";
        box.style.color = "white";
      }
      if (pattern.length === 0) {
        pickInfo.innerText = "Pick: 0 of 0";
        return;
      }
      const currentNumbers = pattern[currentIndex];
      if (Array.isArray(currentNumbers)) {
        currentNumbers.forEach(num => {
          if (num >= 1 && num <= 6) {
            const activeBox = document.getElementById("box" + num);
            activeBox.textContent = num;
            activeBox.classList.add("highlight");
            for (let rule of colorRules) {
              if (rule.numbers.includes(num)) {
                activeBox.style.backgroundColor = rule.color;
                activeBox.style.color = isColorLight(rule.color) ? "black" : "white";
                break;
              }
            }
          }
        });
        if (currentNumbers.length === 1) {
          speakNumber(currentNumbers[0]);
        }
      }
      pickInfo.innerText = `Pick: ${currentIndex + 1} of ${pattern.length}`;
      document.getElementById("progress").style.width = ((currentIndex + 1) / pattern.length * 100) + "%";
    }

    function nextNumber() {
      if (pattern.length === 0) return;
      currentIndex = (currentIndex + 1) % pattern.length;
      updateDisplay();
    }

    function prevNumber() {
      if (pattern.length === 0) return;
      currentIndex = (currentIndex - 1 + pattern.length) % pattern.length;
      updateDisplay();
    }

    function reset() {
      currentIndex = 0;
      updateDisplay();
      document.getElementById("progress").style.width = "0%";
    }

    function jumpToPick() {
      const jumpVal = parseInt(document.getElementById("jumpInput").value);
      if (!isNaN(jumpVal) && jumpVal >= 1 && jumpVal <= pattern.length) {
        currentIndex = jumpVal - 1;
        updateDisplay();
      }
    }

    function speakNumber(num) {
      if (!document.getElementById("speakToggle").checked) return;
      const numberWords = ["one", "two", "three", "four", "five", "six"];
      const word = numberWords[num - 1];
      const audio = new Audio(`${word}.mp3`);
      audio.play();
    }

    function loadCustomSound(event) {
      const file = event.target.files[0];
      if (file) {
        customAudio = URL.createObjectURL(file);
      }
    }

    function addColorRule() {
      const input = document.getElementById("ruleInput").value;
      const color = document.getElementById("ruleColor").value;
      const numbers = input.split(",").map(n => parseInt(n.trim())).filter(n => !isNaN(n) && n >= 1 && n <= 6);
      if (numbers.length === 0) return;
      colorRules.push({ numbers, color });
      updateColorRulesDisplay();
      updateDisplay();
    }

    function updateColorRulesDisplay() {
      const list = document.getElementById("colorRulesList");
      list.innerHTML = '';
      colorRules.forEach((rule, index) => {
        const div = document.createElement('div');
        div.className = 'ruleItem';
        const text = document.createElement('div');
        text.className = 'ruleText';
        const box = document.createElement('div');
        box.className = 'colorBox';
        box.style.backgroundColor = rule.color;
        const numbers = document.createElement('span');
        numbers.textContent = rule.numbers.join(", ");
        text.appendChild(box);
        text.appendChild(numbers);
        const button = document.createElement('button');
        button.textContent = 'Delete';
        button.onclick = () => removeColorRule(index);
        div.appendChild(text);
        div.appendChild(button);
        list.appendChild(div);
      });
    }

    function removeColorRule(index) {
      colorRules.splice(index, 1);
      updateColorRulesDisplay();
      updateDisplay();
    }
  </script>
</body>
</html>
